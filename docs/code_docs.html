

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Code Documentation &mdash; MRI_DistortionQA  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script >mermaid.initialize({startOnLoad:true});</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Reporting" href="reporting.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MRI_DistortionQA
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="examples.html">Worked Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Code Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#markeranalysis">MarkerAnalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-MRI_DistortionQA.FieldCalculation">FieldCalculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-MRI_DistortionQA.FieldAnalysis">FieldAnalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reports">Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-MRI_DistortionQA.utilities">utilities</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MRI_DistortionQA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Code Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/code_docs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="code-documentation">
<h1>Code Documentation<a class="headerlink" href="#code-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="markeranalysis">
<h2>MarkerAnalysis<a class="headerlink" href="#markeranalysis" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-MRI_DistortionQA.FieldCalculation">
<span id="fieldcalculation"></span><h2>FieldCalculation<a class="headerlink" href="#module-MRI_DistortionQA.FieldCalculation" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="MRI_DistortionQA.FieldCalculation.ConvertMatchedMarkersToBz">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.FieldCalculation.</span></code><code class="sig-name descname"><span class="pre">ConvertMatchedMarkersToBz</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">MatchedCentroids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dicom_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.FieldCalculation.ConvertMatchedMarkersToBz" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>MatchedCentroids</strong> – a pandas data frame containing columns [‘x_gt’, ‘y_gt’, ‘z_gt’, ‘x_gnl’, ‘y_gnl’, ‘z_gnl’].
If you want to calculate B0, is should also have [‘x_B0’, ‘y_B0’, ‘z_B0’]. Such a dataframe is normally created
within the MatchedMarkerVolumes class.</p></li>
<li><p><strong>dicom_data</strong> (<em>dictionary</em><em> or </em><em>path</em>) – <p>either a dictionary or a path to a .json file. The minimume required parameters are below.
dicom_data is calculated automatically when MR data is used to create a MarkerVolume, and can be exported
to json using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">marker_volume</span><span class="o">.</span><span class="n">save_dicom_data</span><span class="p">()</span><span class="o">.</span>
</pre></div>
</div>
<p>dicom_data example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dicom_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FOV&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>
<span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="mi">203</span><span class="p">,</span>
<span class="s1">&#39;gama&#39;</span><span class="p">:</span> <span class="mf">42.6</span><span class="p">,</span>
<span class="s1">&#39;image_size&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]}</span>
</pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-MRI_DistortionQA.FieldAnalysis">
<span id="fieldanalysis"></span><h2>FieldAnalysis<a class="headerlink" href="#module-MRI_DistortionQA.FieldAnalysis" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.FieldAnalysis.</span></code><code class="sig-name descname"><span class="pre">SphericalHarmonicFit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_Bz_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_outer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">150</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">AssessHarmonicPk_Pk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">QuantifyFit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TrimDataBy_r_outer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses single value decomposition to fit spherical harmonics to InputData.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>InputData</strong> (<em>Pandas.DataFrame</em>) – A pandas dataframe with columns x, y, z, Bz. Data should be in mm and T</p></li>
<li><p><strong>r_outer</strong> (<em>float</em><em>, </em><em>optional</em>) – radius of sphere of interest. If AssessHarmonicPk_Pk=True, data is reconstucted on r_outer. if
TrimDataBy_r_outer=True, data lying outside r_outer will be deleted. Finally, r_outer is used to set the limits
on plotting data.</p></li>
<li><p><strong>n_order</strong> (<em>int</em><em>, </em><em>optional</em>) – order of harmonic fit. higher order means more terms to fit, which may result in a better fit
but also is slower. If the data you input doesn’t satisfy some nyquist criterion (I need to figure this out!)
then you will get a spurious result. For most MRI application 8 should be a reasonable number.</p></li>
<li><p><strong>AssessHarmonicPk_Pk</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True, data is reconstructed on the surface of r_outer, and the pk-pk contribution
from each harmonic calculated. This is a very useful way to interpret harmonics which are otherwise quite
abstract.</p></li>
<li><p><strong>QuantifyFit</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True, reconstruct data at all input data points, and compare input data point to
reconstructed data point. This is useful to check how well the fit has worked.</p></li>
<li><p><strong>TrimDataBy_r_outer</strong> (<em>bool</em><em>, </em><em>optional</em>) – if True, any input data outside r_outer is deleted</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit.plot_cut_planes">
<code class="sig-name descname"><span class="pre">plot_cut_planes</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">AddColorBar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'uT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit.plot_cut_planes" title="Permalink to this definition">¶</a></dt>
<dd><p>Reconstruct the Bz field at the cardinal planes.
Note this is basically the same code copied three times in  a row, one for each plane.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resolution</strong> (<em>float</em><em>, </em><em>optional</em>) – the resolution of reconstructed data. Default is 2.5 mm</p></li>
<li><p><strong>AddColorBar</strong> (<em>Boolean</em><em>, </em><em>optional</em>) – Add a color bar to each plot</p></li>
<li><p><strong>quantity</strong> (<em>string</em><em>, </em><em>optional</em>) – quantity to use in reconstruct_Bz; must match the options for that function</p></li>
<li><p><strong>vmin</strong> (<em>float</em><em>, </em><em>optional</em>) – same as matplotlib.pyplot.imshow; vmin and vmax control the color map bounds.</p></li>
<li><p><strong>vmax</strong> (<em>float</em><em>, </em><em>optional</em>) – same as matplotlib.pyplot.imshow; vmin and vmax control the color map bounds.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit.plot_harmonics_pk_pk">
<code class="sig-name descname"><span class="pre">plot_harmonics_pk_pk</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cut_off</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit.plot_harmonics_pk_pk" title="Permalink to this definition">¶</a></dt>
<dd><p>produces a barplot of harmonics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cut_off</strong> (<em>float</em><em>, </em><em>optional</em>) – cutoff point relative to highest harmonic. e.g. cut_off=.1 means that harmonics which produce
less than 10% the pk-pk perturbation of the dominant harmonic are ignored.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit.print_key_harmonics">
<code class="sig-name descname"><span class="pre">print_key_harmonics</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cut_off</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.FieldAnalysis.SphericalHarmonicFit.print_key_harmonics" title="Permalink to this definition">¶</a></dt>
<dd><p>print the harmonics with value &gt; cut_off to the terminal in pk-pk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cut_off</strong> (<em>float</em><em>, </em><em>optional</em>) – cutoff point relative to highest harmonic. e.g. cut_off=.1 means that harmonics which produce
less than 10% the pk-pk perturbation of the dominant harmonic are ignored.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="reports">
<h2>Reports<a class="headerlink" href="#reports" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-MRI_DistortionQA.utilities">
<span id="utilities"></span><h2>utilities<a class="headerlink" href="#module-MRI_DistortionQA.utilities" title="Permalink to this headline">¶</a></h2>
<p>General purpose reusable functions</p>
<dl class="py class">
<dt id="MRI_DistortionQA.utilities.bcolors">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">bcolors</span></code><a class="headerlink" href="#MRI_DistortionQA.utilities.bcolors" title="Permalink to this definition">¶</a></dt>
<dd><p>This is just here to enable me to print pretty colors to the linux terminal</p>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.build_dicom_affine">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">build_dicom_affine</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Dicomfiles</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.build_dicom_affine" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform the image based coordinates (i,j,k) to world coordinates (x,y,z)
It must be stated that dicom coordinate systems are a real mess. The reference I used to create the affine is
<a class="reference external" href="https://nipy.org/nibabel/dicom/dicom_orientation.html">NIbabel</a>
(we are using the r/c defined under ‘DICOM affines again’)</p>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.compare_recon_report_with_ground_truth_report">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">compare_recon_report_with_ground_truth_report</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ground_truth_report</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recon_report</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.compare_recon_report_with_ground_truth_report" title="Permalink to this definition">¶</a></dt>
<dd><p>This is to compare the distortion data contained within two Reports.MRI_QA_recon_reporter
objects. The original purpose was to compare a recon_report generated from direct data, and one
generated via harmonics, although in principle it can take any two recon_reports.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ground_truth_report</strong> – Reports.MRI_QA_recon_reporter instance</p></li>
<li><p><strong>recon_report</strong> – Reports.MRI_QA_recon_reporter instance</p></li>
<li><p><strong>tolerance</strong> – tolerance in mm</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.convert_cartesian_to_spherical">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">convert_cartesian_to_spherical</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">InputCoords</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.convert_cartesian_to_spherical" title="Permalink to this definition">¶</a></dt>
<dd><p>Cartesian coordinates contained as columns [x,y,z] in InputCoords are converted to spherical coordinates.
[r, azimuth, elevation]. if r, azimuth, or elevation already exist as column names they are overwritten.
The convention used here matches the convention matlab uses; this is because parts of this code were ported
from an earlier version in matlab.</p>
<ul class="simple">
<li><p>0 &lt;= azimuth &lt;= 2*pi</p></li>
<li><p>0 &lt;= elevation &lt;= pi</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>InputCoords</strong> – a data frame containing (at least) columns x, y, z.</p>
</dd>
<dt class="field-even">Returns InputCoords</dt>
<dd class="field-even"><p>same data frame with additional columns [r, azimuth, elevation]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.convert_spherical_to_cartesian">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">convert_spherical_to_cartesian</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">InputCoords</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.convert_spherical_to_cartesian" title="Permalink to this definition">¶</a></dt>
<dd><p>converts spherical coordinates in InputCoords to Cartesian and adds cartesian into the returned data frame.
if the cartesian columns ‘x’, ‘y’, ‘z’ already exist, they will be overwritten</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>InputCoords</strong> – a data frame containing columns r, azimuth, elevation</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.dicom_to_numpy">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">dicom_to_numpy</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path_to_dicoms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">FilesToReadIn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_extension</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dcm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_XYZ</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.dicom_to_numpy" title="Permalink to this definition">¶</a></dt>
<dd><p>This function does two things:</p>
<ol class="arabic simple">
<li><p>Loads all the dicom files in path_to_dicoms in a numpy array. data is ordered according to [row, column, slice]</p></li>
<li><p>Builds the matrix that transforms the [r,c,s] indices into [x,y,z] coordinates</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path_to_dicoms</strong> (<em>pathlib.Path</em><em> or </em><em>string</em>) – folder where all dicoms images are stored</p></li>
<li><p><strong>FilesToReadIn</strong> (<em>list</em><em>, </em><em>optional</em>) – By default, this function will read in all files of file type file_extension. If you only want
to read in a subset of files, you can specify them with FilesToReadIn</p></li>
<li><p><strong>file_extension</strong> (<em>string</em>) – extension of dicom files, e.g. ‘dcm’ or ‘IMA’</p></li>
<li><p><strong>return_XYZ</strong> (<em>bool</em>) – if True, will build and return three matrics containing the X, Y, and Z coords at each i,j,k
pixel.</p></li>
</ul>
</dd>
<dt class="field-even">Returns ImageArray</dt>
<dd class="field-even"><p>a numpy array of voxels</p>
</dd>
<dt class="field-odd">Returns dicom_affine</dt>
<dd class="field-odd"><p>a matrix that transforms the [r,c,s] indices into [x,y,z] coordinates</p>
</dd>
<dt class="field-even">Returns (X, Y, Z)</dt>
<dd class="field-even"><p>Coordinate arrays the same size as ImageArray. Optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.generate_legendre_basis">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">generate_legendre_basis</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">InputCoords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_order</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.generate_legendre_basis" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce spherical base at all coordinate values.
This utilises the ‘fully normalised’ convention described here &lt;<a class="reference external" href="https://au.mathworks.com/help/matlab/ref/legendre.html">https://au.mathworks.com/help/matlab/ref/legendre.html</a>&gt;`_
Note that we scale all r values by 1000, which is to help ensure numerical stability. This is based on the assumption
that this input data is in mm. The code will throw a warning if this does not appear to the case.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>InputCoords</strong> – a data frame which can contain whatever you want, but MUST contain columns called
elevation, azimuth, and r</p>
</dd>
<dt class="field-even">Returns legendre_basis</dt>
<dd class="field-even"><p>a pandas data frame of size [Ncoords, (n_order +1)**2)]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.get_all_files">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">get_all_files</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">PathToData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_extension</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.get_all_files" title="Permalink to this definition">¶</a></dt>
<dd><p>quick script to just collect all the files in the Analysis path</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>PathToData</strong> (<em>pathlib.Path</em><em> or </em><em>string</em>) – folder where the files are</p></li>
<li><p><strong>file_extension</strong> (<em>str</em>) – extension of files to return, e.g. ‘dcm’</p></li>
</ul>
</dd>
<dt class="field-even">Returns Files</dt>
<dd class="field-even"><p>list of all found files</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.get_gradient_spherical_harmonics">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">get_gradient_spherical_harmonics</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Gx_Harmonics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gy_Harmonics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Gz_Harmonics</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.get_gradient_spherical_harmonics" title="Permalink to this definition">¶</a></dt>
<dd><p>return the gradient spherica harmonics as as pandas series.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>Harmonics</strong> – either a pandas series or a path to a csv. If it is already a series we do nothing, but handle
this option for cleaner code elsewhere.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.plot_MarkerVolume_overlay">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">plot_MarkerVolume_overlay</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">MarkerVolumeList</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">legend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.plot_MarkerVolume_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot overlaid 3D scatter plots of the marker positions in each MarkerVolume</p>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.plot_MarkerVolume_z_hist">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">plot_MarkerVolume_z_hist</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">MarkerVolume1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MarkerVolume2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.plot_MarkerVolume_z_hist" title="Permalink to this definition">¶</a></dt>
<dd><p>This will plot a histogram of how many markers are at each z_bin.
It is useful to compare two marker volumes and get an idea of which planes there may be missing or extra
markers on</p>
</dd></dl>

<dl class="py function">
<dt id="MRI_DistortionQA.utilities.reconstruct_Bz">
<code class="sig-prename descclassname"><span class="pre">MRI_DistortionQA.utilities.</span></code><code class="sig-name descname"><span class="pre">reconstruct_Bz</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">harmonics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'uT'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_outer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MRI_DistortionQA.utilities.reconstruct_Bz" title="Permalink to this definition">¶</a></dt>
<dd><p>Reconstruct Bz at an arbitrary set of coordinates.
n_order of reconstruction is derived from the shape of harmonics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>harmonics</strong> – a pandase series of size (n_order+1)^2, such as that defined within
FieldAnalysis.SphericalHarmonicFit</p></li>
<li><p><strong>coords</strong> – a pandas Dataframe which can contain whatever you want, but MUST contain columns called:
elevation, azimuth, and r</p></li>
<li><p><strong>quantity</strong> – <ul>
<li><p>‘T’: return raw field in T</p></li>
<li><p>’uT’: return field in uT, with A00 set to 0.</p></li>
<li><p>’PPM’:</p></li>
</ul>
</p></li>
<li><p><strong>r_outer</strong> (<em>float</em><em> or </em><em>None</em>) – optional parameter; if you try to reconstruct points with r &gt; r_outer a warning is thrown</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="reporting.html" class="btn btn-neutral float-left" title="Reporting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Brendan Whelan(s).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>